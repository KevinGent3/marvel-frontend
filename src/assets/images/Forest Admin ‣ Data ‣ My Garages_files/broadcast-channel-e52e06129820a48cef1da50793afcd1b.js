!function(t){const e=[];function s(s){const r=this,n=`$BroadcastChannel$${s=String(s)}$`;e[n]=e[n]||[],e[n].push(this),this._name=s,this._id=n,this._closed=!1,this._mc=new MessageChannel,this._mc.port1.start(),this._mc.port2.start(),t.addEventListener("storage",(e=>{if(e.storageArea!==t.localStorage)return;if(null===e.newValue)return;if(e.key.substring(0,n.length)!==n)return;const s=JSON.parse(e.newValue);r._mc.port2.postMessage(s)}))}s.prototype={get name(){return this._name},postMessage(s){const r=this;if(this._closed){const t=new Error;throw t.name="InvalidStateError",t}const n=JSON.stringify(s),o=`${this._id+String(Date.now())}$${String(Math.random())}`;t.localStorage.setItem(o,n),setTimeout((()=>{t.localStorage.removeItem(o)}),500),e[this._id].forEach((t=>{t!==r&&t._mc.port2.postMessage(JSON.parse(n))}))},close(){if(this._closed)return;this._closed=!0,this._mc.port1.close(),this._mc.port2.close();const t=e[this._id].indexOf(this);e[this._id].splice(t,1)},get onmessage(){return this._mc.port1.onmessage},set onmessage(t){this._mc.port1.onmessage=t},addEventListener(){return this._mc.port1.addEventListener.apply(this._mc.port1,arguments)},removeEventListener(){return this._mc.port1.removeEventListener.apply(this._mc.port1,arguments)},dispatchEvent(){return this._mc.port1.dispatchEvent.apply(this._mc.port1,arguments)}},t.BroadcastChannel=t.BroadcastChannel||s}(self);